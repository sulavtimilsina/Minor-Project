import 'dart:convert';
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:helloflutter/screens/doctor/widgets/drawer.dart';
import 'package:intl/intl.dart';
import 'dates_list.dart';
import 'theme/colors/light_colors.dart';
import 'widgets/calendar_dates.dart';
//import 'widgets/task_container.dart';
import 'create_new_task_page.dart';
import 'models/task_model.dart';
import 'package:http/http.dart' as http;

Future<List<Task>> fetchAlbum() async {
  final storage = new FlutterSecureStorage();
  String value = await storage.read(key: "x-auth-token");
  final response =
      await http.get('http://10.0.2.2:3000/schedule', headers: <String, String>{
    'Content-Type': 'application/json; charset=UTF-8',
    HttpHeaders.authorizationHeader: value
  });

  if (response.statusCode == 200) {
    // If the server did return a 200 OK response,
    // then parse the JSON.
    var tagObjsJson = jsonDecode(response.body) as List;
    List<Task> tagObjs =
        tagObjsJson.map((tagJson) => Task.fromJson(tagJson)).toList();

    return tagObjs;
  } else {
    // If the server did not return a 200 OK response,
    // then throw an exception.
    throw Exception('Failed to load album');
  }
}

class HomePage extends StatefulWidget {
  @override
  _HomePageState createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  Future<List<Task>> futureAlbum;

  String getDate() {
    DateTime date = DateTime.now();
    String formattedDate = DateFormat('yyyy-MM-dd').format(date);
    return formattedDate;
  }

  // @override
  // void initState() {
  //   super.initState();
  //   futureAlbum = fetchAlbum();
  // }

  // Widget _dashedText() {
  //   return Container(
  //     padding: EdgeInsets.symmetric(vertical: 15),
  //     child: Text(
  //       '------------------------------------------',
  //       maxLines: 1,
  //       style:
  //           TextStyle(fontSize: 20.0, color: Colors.black12, letterSpacing: 5),
  //     ),
  //   );
  // }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: LightColors.kLightYellow,
      appBar: AppBar(
        title: Text("Schedulehello"),
      ),
      drawer: DrawerWidget(),
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.fromLTRB(
            20,
            20,
            20,
            0,
          ),
          child: Column(
            children: <Widget>[
              SizedBox(height: 5.0),
              Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: <Widget>[
                    Text(
                      'Today',
                      style: TextStyle(
                          fontSize: 30.0, fontWeight: FontWeight.w700),
                    ),
                    Container(
                      height: 40.0,
                      width: 120,
                      decoration: BoxDecoration(
                        color: LightColors.kGreen,
                        borderRadius: BorderRadius.circular(30),
                      ),
                      child: FlatButton(
                        onPressed: () {
                          Navigator.push(
                            context,
                            MaterialPageRoute(
                              builder: (context) => CreateNewTaskPage(),
                            ),
                          );
                        },
                        child: Center(
                          child: Text(
                            'Add task',
                            style: TextStyle(
                                color: Colors.white,
                                fontWeight: FontWeight.w700,
                                fontSize: 16),
                          ),
                        ),
                      ),
                    ),
                  ]),
              SizedBox(height: 30),
              Align(
                alignment: Alignment.centerLeft,
                child: Text(
                  getDate(),
                  style: TextStyle(fontWeight: FontWeight.w500, fontSize: 20),
                ),
              ),
              SizedBox(height: 20.0),
              Container(
                height: 58.0,
                child: ListView.builder(
                  scrollDirection: Axis.horizontal,
                  itemCount: days.length,
                  itemBuilder: (BuildContext context, int index) {
                    return CalendarDates(
                      day: days[index],
                      date: dates[index],
                      dayColor: index == 0 ? LightColors.kRed : Colors.black54,
                      dateColor:
                          index == 0 ? LightColors.kRed : LightColors.kDarkBlue,
                    );
                  },
                ),
              ),
              // Expanded(
              //   child: SingleChildScrollView(
              //     child: Container(
              //       padding: EdgeInsets.symmetric(vertical: 20.0),
              //       child: Row(
              //         crossAxisAlignment: CrossAxisAlignment.start,
              //         mainAxisAlignment: MainAxisAlignment.spaceBetween,
              //         children: <Widget>[
              //           Expanded(
              //             flex: 1,
              //             child: ListView.builder(
              //               itemCount: time.length,
              //               shrinkWrap: true,
              //               physics: NeverScrollableScrollPhysics(),
              //               itemBuilder: (BuildContext context, int index) =>
              //                   Padding(
              //                 padding:
              //                     const EdgeInsets.symmetric(vertical: 15.0),
              //                 child: Align(
              //                   alignment: Alignment.centerLeft,
              //                   child: Text(
              //                     '${time[index]} ${time[index] > 8 ? 'PM' : 'AM'}',
              //                     style: TextStyle(
              //                       fontSize: 16.0,
              //                       color: Colors.black54,
              //                     ),
              //                   ),
              //                 ),
              //               ),
              //             ),
              //           ),
              //           SizedBox(
              //             width: 20,
              //           ),
              //           Expanded(
              //               flex: 5,
              //               child: FutureBuilder<List<Task>>(
              //                 future: futureAlbum,
              //                 builder: (context, snapshot) {
              //                   if (snapshot.hasData) {
              //                     return ListView.builder(
              //                         shrinkWrap: true,
              //                         physics: NeverScrollableScrollPhysics(),
              //                         itemCount: snapshot.data.length,
              //                         itemBuilder:
              //                             (BuildContext context, int index) {
              //                           //print(snapshot.data[index].patient.username);
              //                           return TaskContainer(
              //                             startTime:
              //                                 snapshot.data[index].startTime,
              //                             endTime: snapshot.data[index].endTime,
              //                             boxColor: LightColors.kLightYellow2,
              //                             patient:
              //                                 snapshot.data[index].patient !=
              //                                         null
              //                                     ? snapshot.data[index].patient
              //                                         .username
              //                                     : 'not booked',
              //                           );
              //                         });
              //                   } else {
              //                     return Expanded(
              //                         child: Text("snapshot.error"));
              //                   }

              //                   // By default, show a loading spinner.
              //                   // return CircularProgressIndicator();
              //                 },
              //               ))
              //         ],
              //       ),
              //     ),
              //   ),
              // ),
            ],
          ),
        ),
      ),
    );
  }
}

  List<DoctorInfo> doctorInfo = [
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
    DoctorInfo(
      image:
          "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/10b3cb41-186f-499b-a824-e369f838b46b/d14pin8-a53f8ce9-49db-4d88-ba03-5813128779b5.jpg/v1/fill/w_719,h_1111,q_75,strp/dr__manhattan_watchmen_series_by_thuddleston.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwic3ViIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl0sIm9iaiI6W1t7InBhdGgiOiIvZi8xMGIzY2I0MS0xODZmLTQ5OWItYTgyNC1lMzY5ZjgzOGI0NmIvZDE0cGluOC1hNTNmOGNlOS00OWRiLTRkODgtYmEwMy01ODEzMTI4Nzc5YjUuanBnIiwid2lkdGgiOiI8PTcxOSIsImhlaWdodCI6Ijw9MTExMSJ9XV19.b_Qs8ta95vIP8QUOEXF9poRApWNBwji0LKHNMmVW7vE",
      about:
          "Jon gradually becomes a pawn of the U.S. government, which gives him the code name Doctor Manhattan—a reference to the Manhattan Project—and a costume which he begrudgingly accepts. Doctor Manhattan chooses as his emblem a representation of a hydrogen atom, whose simplicity he declares to be something that kindles his respect; accordingly, he painlessly burns the mark into his forehead. This preference for material mechanisms marks the beginning of his declining humanity, which is progressively mirrored by his gradual shedding of the uniform; by the end of the 1970s, he refuses to wear anything at all except during mandatory public appearances. ",
      certifications: "5",
      experience: "50",
      address: "Mars",
      name: "Dr Manhattan",
      speciality: "Everything",
      workingHours: "Sun - Fri 09:00 - 05:00",
      nmcNumber: "1013232",
      education: [
        "Bachelors from IOM Nepal",
        "Currently working at Bir Hospital Nepal"
      ],
    ),
  ];

              Container(
              height: MediaQuery.of(context).size.height * 0.74,
              child: ListView.builder(
                itemCount: doctorInfo.length,
                shrinkWrap: true,
                itemBuilder: (context, index) => DoctorContainer(
                  //id: doctorInfo[index].id,
                  image: doctorInfo[index].image,
                  certifications: doctorInfo[index].certifications,
                  about: doctorInfo[index].about,
                  experience: doctorInfo[index].experience,
                  name: doctorInfo[index].name,
                  speciality: doctorInfo[index].speciality,
                  nmcNumber: doctorInfo[index].nmcNumber,
                  address: doctorInfo[index].address,
                ),
              ),
            ),

            /// DEFINSE THE DOCTOR CLASS FOR STORING DOCTOR INFO MOVE TO ANOTHER FILE

///GO TO A SPECIFIC PAGE  for A SPECIFIC DOCTOR
///FOR TESTINNG CREATE A SPECIFIC PAGE LATER
/// NO LONGER NEEDED CAN DELETE
///
class DoctorDetailPage extends StatelessWidget {
  final DoctorInfo doctor;
  DoctorDetailPage(this.doctor);
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        height: 100,
        width: 200,
        decoration: BoxDecoration(
          color: Colors.lightGreen,
        ),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(
              doctor.speciality,
            )
          ],
        ),
      ),
    );
  }
}

